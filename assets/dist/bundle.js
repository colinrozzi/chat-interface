var O=document.getElementById("new-chat-btn"),B=document.getElementById("conversation-list"),l=document.getElementById("messages-container"),k=document.getElementById("message-input"),_=document.getElementById("send-button"),L=document.getElementById("current-conversation-title"),f=document.getElementById("settings-panel"),F=document.getElementById("close-settings-btn"),M=document.getElementById("settings-form"),p=document.getElementById("temperature-input"),I=document.getElementById("temperature-value"),d=null,a=null,r=[],x=!1;function P(){H(),j(),se(),ce(),le(),ae()}function H(){let t=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;d=new WebSocket(t),d.onopen=()=>{console.log("WebSocket connection established"),g("list_conversations")},d.onmessage=n=>{let o=JSON.parse(n.data);R(o)},d.onclose=()=>{console.log("WebSocket connection closed"),setTimeout(H,3e3)},d.onerror=n=>{console.error("WebSocket error:",n)}}function j(){O.addEventListener("click",U),_.addEventListener("click",N),k.addEventListener("keydown",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),N())}),F.addEventListener("click",()=>{f.classList.add("collapsed")}),M.addEventListener("submit",ne),p.addEventListener("input",oe),Z()}function U(){C(),g("new_conversation")}function N(){let e=k.value.trim();if(!e||!a||x)return;A(e),V(),x=!0,_.disabled=!0,g("send_message",{conversation_id:a,message:{role:"user",content:[{type:"text",text:e}]}}),k.value=""}function V(){let e=document.createElement("div");e.className="loading",e.id="loading-indicator";let t=document.createElement("div");t.className="loading-dots";for(let n=0;n<3;n++){let o=document.createElement("div");o.className="loading-dot",t.appendChild(o)}e.appendChild(t),l.appendChild(e),l.scrollTop=l.scrollHeight}function J(){let e=document.getElementById("loading-indicator");e&&e.remove(),x=!1,_.disabled=!1}function g(e,t={}){if(!d||d.readyState!==WebSocket.OPEN){h("Connection to server lost. Trying to reconnect...");return}let n={action:e,...t};d.send(JSON.stringify(n))}function R(e){switch(console.log("Received message:",e),J(),e.type){case"welcome":break;case"conversation_created":q(e);break;case"conversation_list":z(e.conversations);break;case"message":K(e);break;case"messages":G(e);break;case"history":Q(e);break;case"error":h(e.message);break;case"settings":te(e.settings);break;case"settings_updated":S("Settings updated successfully");break;default:console.warn("Unknown message type:",e.type)}}function q(e){if(a=e.conversation_id,L.textContent="New Conversation",!r.some(t=>t.id===e.conversation_id)){let t={id:e.conversation_id,title:"New Conversation",last_message_preview:null,created_at:Date.now(),updated_at:Date.now(),message_count:0};r.push(t),v()}C()}function z(e){r=Object.values(e),v()}function w(e){return!e||!e.content||!Array.isArray(e.content)?"":e.content.filter(t=>t.type==="text").map(t=>t.text).join(`
`)}function K(e){e.conversation_id===a&&T(e.message);let t=r.find(n=>n.id===e.conversation_id);if(t){let n=w(e.message);t.last_message_preview=n.substring(0,50)+(n.length>50?"...":""),t.updated_at=Date.now(),t.message_count=(t.message_count||0)+1,v()}}function G(e){e.conversation_id===a&&e.messages.forEach((n,o)=>{n.role==="assistant"&&T(n)});let t=r.find(n=>n.id===e.conversation_id);if(t&&e.messages.length>0){let n=e.messages.filter(o=>o.role==="assistant");if(n.length>0){let o=n[n.length-1],s=w(o);t.last_message_preview=s.substring(0,50)+(s.length>50?"...":""),t.updated_at=Date.now(),t.message_count=(t.message_count||0)+n.length,v()}}}function Q(e){e.conversation_id===a&&(C(),e.messages.forEach(t=>{t.role==="user"?A(w(t)):t.role==="assistant"&&T(t)}))}function A(e){X("user",e)}function D(){let e=document.createElement("button");return e.className="copy-button",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',e.title="Copy to clipboard",e.addEventListener("click",function(t){t.stopPropagation();let o=this.parentElement.innerText.replace("Copy to clipboard","").trim();navigator.clipboard.writeText(o).then(()=>{let s=this.innerHTML;this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',setTimeout(()=>{this.innerHTML=s},2e3),S("Copied to clipboard")}).catch(s=>{console.error("Could not copy text: ",s),h("Failed to copy text")})}),e}function T(e){let t=document.createElement("div");t.className="message assistant";let n=D();if(t.appendChild(n),e.content&&Array.isArray(e.content))e.content.forEach(o=>{switch(o.type){case"text":let s=document.createElement("div");s.innerHTML=o.text.replace(/\n/g,"<br>"),t.appendChild(s);break;case"tool_use":let i=document.createElement("div");i.className="tool-use";let c=document.createElement("div");c.className="tool-name",c.textContent=`Tool: ${o.name}`,i.appendChild(c);let E=document.createElement("div");E.className="tool-id",E.textContent=`ID: ${o.id}`,i.appendChild(E);let u=document.createElement("pre");u.className="tool-input";try{u.textContent=JSON.stringify(o.input,null,2)}catch{u.textContent=String(o.input)}i.appendChild(u),t.appendChild(i);break;case"tool_result":let m=document.createElement("div");m.className="tool-result",o.is_error&&m.classList.add("error");let b=document.createElement("div");b.className="tool-id",b.textContent=`Tool ID: ${o.tool_use_id}`,m.appendChild(b);let y=document.createElement("pre");y.className="tool-content";try{y.textContent=JSON.stringify(o.content,null,2)}catch{y.textContent=String(o.content)}m.appendChild(y),t.appendChild(m);break;default:console.warn(`Unknown content type: ${o.type}`)}});else{let o=typeof e=="string"?e:w(e);t.innerHTML=o.replace(/\n/g,"<br>")}l.appendChild(t),l.scrollTop=l.scrollHeight}function X(e,t){let n=l.querySelector(".welcome-message");n&&n.remove();let o=document.createElement("div");o.className=`message ${e}`;let s=D();o.appendChild(s);let i=document.createElement("div");i.className="message-content";let c=t;c=c.replace(/```([\w]*)\n([\s\S]*?)```/g,function(E,u,m){return`<pre><code class="language-${u||"plaintext"}">${m.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`}),c=c.replace(/`([^`]+)`/g,"<code>$1</code>"),c=c.replace(/\n/g,"<br>"),i.innerHTML=c,o.appendChild(i),l.appendChild(o),l.scrollTop=l.scrollHeight}function v(){B.innerHTML="",[...r].sort((t,n)=>(n.updated_at||0)-(t.updated_at||0)).forEach(t=>{let n=document.createElement("div");n.className="conversation-item",t.id===a&&n.classList.add("active");let o=document.createElement("div");if(o.className="conversation-title",o.textContent=t.title,n.appendChild(o),t.last_message_preview){let s=document.createElement("div");s.className="conversation-preview",s.textContent=t.last_message_preview,n.appendChild(s)}n.dataset.id=t.id,n.addEventListener("click",()=>{Y(t.id)}),B.appendChild(n)})}function Y(e){a=e,v(),C();let t=r.find(n=>n.id===e);t&&(L.textContent=t.title),g("get_history",{conversation_id:e}),W(e)}function C(){l.innerHTML=""}function h(e){let t=document.createElement("div");t.className="error-message",t.textContent=e,l.appendChild(t),setTimeout(()=>{t.remove()},5e3)}window.addEventListener("DOMContentLoaded",P);function Z(){let e=document.querySelector(".chat-header"),t=document.createElement("button");t.className="settings-button",t.innerHTML=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
    `,t.addEventListener("click",ee),e.appendChild(t)}function ee(){if(f.classList.contains("collapsed"))if(a)f.classList.remove("collapsed"),W(a);else{h("Please select or create a conversation first");return}else f.classList.add("collapsed")}function W(e){e&&g("get_settings",{conversation_id:e})}function te(e){if(!e)return;let t=document.getElementById("model-select");if(t&&(t.value=e.model||"claude-3-7-sonnet-20250219"),p){let i=e.temperature!==void 0?e.temperature:.7;p.value=i,I.textContent=i}let n=document.getElementById("max-tokens-input");n&&(n.value=e.max_tokens||4096);let o=document.getElementById("system-prompt-input");o&&(o.value=e.system_prompt||"");let s=document.getElementById("title-input");if(s){let i=r.find(c=>c.id===a);i&&(s.value=i.title||"")}}function ne(e){if(e.preventDefault(),!a){h("No active conversation");return}let t=new FormData(M),n={model:t.get("model"),temperature:parseFloat(t.get("temperature")),max_tokens:parseInt(t.get("max_tokens")),title:t.get("title"),system_prompt:t.get("system_prompt")||null,additional_params:{}};console.log("Saving settings:",n),g("update_settings",{conversation_id:a,settings:n});let o=r.find(s=>s.id===a);o&&n.title&&(o.title=n.title,L.textContent=n.title,v()),S("Settings updated successfully")}function oe(){I.textContent=p.value}function S(e){let t=document.createElement("div");t.className="message-notification",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}function se(){f.classList.add("collapsed"),ie()}function ie(){let e=document.getElementById("model-select");e&&(e.selectedIndex=0),p&&(p.value=.7,I.textContent=.7);let t=document.getElementById("max-tokens-input");t&&(t.value=4096);let n=document.getElementById("system-prompt-input");n&&(n.value="");let o=document.getElementById("title-input");o&&(o.value="")}function ae(){let e=document.getElementById("sidebar-toggle"),t=document.querySelector(".sidebar");function n(){window.innerWidth<=768?(e.style.display="flex",t.classList.contains("mobile-shown")||t.classList.add("mobile-hidden")):(e.style.display="none",t.classList.remove("mobile-hidden"))}e.addEventListener("click",function(){t.classList.toggle("mobile-hidden"),t.classList.toggle("mobile-shown")}),n(),window.addEventListener("resize",n),document.addEventListener("click",function(o){window.innerWidth<=768&&o.target.closest(".conversation-item")&&(t.classList.add("mobile-hidden"),t.classList.remove("mobile-shown"))})}function ce(){let e=document.getElementById("theme-toggle");e&&e.addEventListener("change",function(){this.checked?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(document.documentElement.removeAttribute("data-theme"),localStorage.setItem("theme","light"))})}function le(){let e=localStorage.getItem("theme"),t=document.getElementById("theme-toggle");e==="dark"&&(document.documentElement.setAttribute("data-theme","dark"),t&&(t.checked=!0))}
//# sourceMappingURL=bundle.js.map
